#!/bin/bash

# Igor Duarte Cardoso
# 1.1.1 - trunk

usage() {
    echo "Usage: "
    echo "  srv list"
    echo "  srv <services' prefix string> <operation>" 
    echo "  srv disable <services' prefix string>" 
    echo "  srv enable <services' prefix string>" 
    echo "Examples: "
    echo "  srv neutron restart"
    echo "  srv disable neutron"
    exit
}

if [ $# -lt 1 ]; then
  usage
fi

case "$1" in

"list")
  cd /etc/init.d/
  for file in *; do
    if [ -h $file ]
      then echo $file
    fi
  done
  ;;

"enable")
  if [ $# -lt 2 ]; then
    usage
  fi
  for file in /etc/init.d/$2*; do
    servname=${file##*/}
    sudo rm "/etc/init/${servname}.override" > /dev/null 2>&1 # upstart
    echo "Enabling $servname"
    #sudo update-rc.d ${servname} defaults > /dev/null 2>&1 # rc.d
  done
  ;;

"disable")
  if [ $# -lt 2 ]; then
    usage
  fi
  for file in /etc/init.d/$2*; do
    servname=${file##*/}
    echo 'manual' | sudo tee "/etc/init/${servname}.override" > /dev/null 2>&1 # upstart
    echo "Disabling $servname"
    #sudo update-rc.d -f ${file##*/} remove > /dev/null 2>&1 # rc.d
  done
  ;;

*)
  if [ $# -lt 2 ]; then
    usage
  fi
  for file in /etc/init.d/$1*; do
    sudo service ${file##*/} $2
  done
  ;;

esac
